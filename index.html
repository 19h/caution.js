<script src="modules/caution.js"></script>
<script>
var baseUrl = location.href.replace(/[^\/]+$/, '');

var modulePaths = [{'main-page': baseUrl + 'main-page.js'}, baseUrl + 'modules/{}.js'];

require(['caution'], function (caution) {
	caution.addUrls(modulePaths);
	
	caution.getFirst(caution.urls('caution'), true, function (error, text, cautionHash) {
		if (error) throw error;
		caution.getFirst(caution.urls('main-page'), true, function (error, text, mainPageHash) {
			if (error) throw error;
			
			// We now have the hashed versions of our initial two modules
			var config = {
				paths: modulePaths,
				load: {
					'caution': cautionHash,
					'main-page': mainPageHash
				},
				DEBUG: caution.DEBUG || /#(.*&)*debug($|&)/.test(location.href)
			};

			if (/#redirect/.test(location.href)) {
				var url = caution.dataUrl(config, {baseUrl: baseUrl});
				return location.replace(url);
			}
			
			var js = caution.inlineJs(config, {baseUrl: baseUrl});
			console.log(js);
			Function(js)();
		});
	});
});

</script>