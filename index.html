<script src="modules/caution.js"></script>
<script>
var baseUrl = location.href.replace(/[^\/]+$/, '');

define(['caution'], function (caution) {
	caution.urls = function (moduleName) {
		return [
			moduleName + '.js',
			'modules/' + moduleName + '.js'
		];
	};
	caution.addSafe(function (text, hash) {
		return true; // No verification
	});

	caution.load('caution');
	caution.load('main-page');
});

define(['caution', 'main-page'], function (caution) {
	caution.getFirst(caution.urls('caution'), null, function (error, text, cautionHash) {
		var config = {
			paths: [{'main-page': baseUrl + 'main-page.js'}, baseUrl + 'modules/{}.js'],
			load: {
				'caution': cautionHash,
				'main-page': [caution.moduleHash('main-page')]
			}
		};
		
		var url = caution.dataUrl(config, {baseUrl: baseUrl});
		if (/#redirect/.test(location.href)) return location.replace(url);

		var js = caution.inlineJs(config, {baseUrl: baseUrl});
		console.log(js);
		console.log(url);
		console.log('length', url.length);
	});
});
</script>